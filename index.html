<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>CV Parsing Kosten Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    label { display: block; margin-top: 15px; }
    select, input { padding: 5px; margin-top: 5px; }
    .result { margin-top: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
    .muted { color: #666; font-size: 12px; margin-top: 10px; }
    .total { font-size: 18px; font-weight: bold; }
  </style>
</head>
<body>

<h2>CV Parsing Kosten Calculator</h2>

<label>
  Aantal CV's:
  <input type="number" id="nCv" value="1000">
</label>

<label>
  Parsing type:
  <select id="parsingType">
    <option value="keywords">Keywords</option>
    <option value="exp">Werkervaring & Opleiding</option>
  </select>
</label>

<label>
  Model:
  <select id="modelSelect"></select>
</label>

<div class="result" id="result"></div>

<script>

// =====================
// TOKEN AANNAMES
// =====================
const TOKEN_COUNTS = {
  keywords: { input: 2833, output: 135 },
  exp: { input: 9640, output: 833 }
};

// =====================
// MODEL PRIJZEN (USD per 1M tokens)
// =====================
let MODEL_PRICES = {
  "gpt-5.2":       { input: 1.75, output: 14.00 },
  "gpt-5-nano":    { input: 0.05, output: 0.40 },

  "gpt-4.1":       { input: 3.00, output: 12.00 },
  "gpt-4.1-mini":  { input: 0.80, output: 3.20 },
  "gpt-4.1-nano":  { input: 0.20, output: 0.80 }
};

// =====================
// LIVE WISSELKOERS
// =====================
const FX_ENDPOINT = "https://api.frankfurter.app/latest?from=USD&to=EUR";
const FX_STORAGE_KEY = "usd_to_eur_cache_v2";
const FX_DATE_KEY = "usd_to_eur_date_v2";

let USD_TO_EUR = 0.92; // fallback
let FX_DATE = null;

function loadCachedFx() {
  const cachedRate = localStorage.getItem(FX_STORAGE_KEY);
  const cachedDate = localStorage.getItem(FX_DATE_KEY);
  if (cachedRate) {
    USD_TO_EUR = parseFloat(cachedRate);
    FX_DATE = cachedDate;
  }
}

async function refreshFx() {
  loadCachedFx();

  try {
    const res = await fetch(FX_ENDPOINT, { cache: "no-store" });
    const data = await res.json();
    if (data?.rates?.EUR) {
      USD_TO_EUR = data.rates.EUR;
      FX_DATE = data.date;
      localStorage.setItem(FX_STORAGE_KEY, USD_TO_EUR);
      localStorage.setItem(FX_DATE_KEY, FX_DATE);
    }
  } catch (e) {
    // fallback blijft actief
  }

  calculate();
}

// =====================
// DROPDOWN MODELLEN
// =====================
const modelOrder = [
  "gpt-5.2",
  "gpt-5-nano",
  "gpt-4.1",
  "gpt-4.1-mini",
  "gpt-4.1-nano"
];

const modelSelect = document.getElementById("modelSelect");

modelOrder.forEach(model => {
  const opt = document.createElement("option");
  opt.value = model;
  opt.textContent = model;
  modelSelect.appendChild(opt);
});

// =====================
// CALCULATIE
// =====================
function calculate() {
  const nCv = parseInt(document.getElementById("nCv").value) || 0;
  const parsing = document.getElementById("parsingType").value;
  const model = document.getElementById("modelSelect").value;

  const tokens = TOKEN_COUNTS[parsing];
  const totalInput = tokens.input * nCv;
  const totalOutput = tokens.output * nCv;

  const prices = MODEL_PRICES[model];

  const costUSD =
    (totalInput / 1_000_000) * prices.input +
    (totalOutput / 1_000_000) * prices.output;

  const costEUR = costUSD * USD_TO_EUR;
  const costPerCvEUR = nCv > 0 ? costEUR / nCv : 0;

  const fxInfo = FX_DATE
    ? `Wisselkoers USD→EUR: ${USD_TO_EUR.toFixed(6)} (ECB ${FX_DATE})`
    : `Wisselkoers USD→EUR: ${USD_TO_EUR.toFixed(6)} (fallback/cache)`;

  document.getElementById("result").innerHTML = `
    <div>
      <strong>Model:</strong> ${model}<br>
      <strong>Parsing type:</strong> ${parsing === "keywords" ? "Keywords" : "Werkervaring & Opleiding"}<br>
      <strong>Aantal CV's:</strong> ${nCv.toLocaleString()}<br><br>

      <strong>Input tokens totaal:</strong> ${totalInput.toLocaleString()}<br>
      <strong>Output tokens totaal:</strong> ${totalOutput.toLocaleString()}<br><br>

      <div class="total">€ ${costEUR.toFixed(2)} totaal</div>
      $ ${costUSD.toFixed(2)} USD<br><br>

      € ${costPerCvEUR.toFixed(4)} per CV

      <div class="muted">${fxInfo}</div>
    </div>
  `;
}

// =====================
// INIT
// =====================
document.querySelectorAll("input, select").forEach(el =>
  el.addEventListener("input", calculate)
);

calculate();
refreshFx();

</script>

</body>
</html>
